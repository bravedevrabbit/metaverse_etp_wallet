import { Component } from '@angular/core'
import { IonicPage, NavController } from 'ionic-angular'
import { MvsServiceProvider } from '../../providers/mvs-service/mvs-service';
import { AlertProvider } from '../../providers/alert/alert';

@IonicPage()
@Component({
    selector: 'page-decode-tx',
    templateUrl: 'decode-tx.html',
})

export class DecodeTxPage {

    decodedTx: any
    input: string

    constructor(
        public navCtrl: NavController,
        private mvs: MvsServiceProvider,
        private alert: AlertProvider,
        private nav: NavController,
    ) { 
        //MIT transfer:
        this.decode("0400000002cecefcbd8ca62b2fea08bc1225db30df833ac7c5547738ab57e7ff2ce3a3d0b00100000000ffffffffcecefcbd8ca62b2fea08bc1225db30df833ac7c5547738ab57e7ff2ce3a3d0b00000000000ffffffff0200000000000000001976a91485df6dc5a453fcaba91531e4d6b21e8fe3ee359088accf000000060000000c546573744163636f756e7435000205746573743222744b38546151697839515367614141505461556a374e774b4d66626b57524b675666d07fe10c180900001976a91485df6dc5a453fcaba91531e4d6b21e8fe3ee359088ac010000000000000000000000")
        //this.decode("04000000020f7ae7153c79ab530018ec36a2f12de54d804bf8d2cb163aa88c0c763568bce9010000006b483045022100e6ccd19b9910ddf61a319734653467959860c39cb302c0933fd3d1408c67917e0220355776165609d11a4753ceaf760173ec1633ea32718c7b08a6607a278ab7b87501210335edaff18efa85748f174ca3dc8753e559da948674ba35adba127d8d5333d2e9ffffffff887300766c576b3a81ccf37ba96aeabae6b352922c4237d4ea7fda328b7f9ead000000006b4830450221008bc3bc71e135cac2a85f4402433fd6894f8141ec73d589e3b74e6209b0ce281f0220572520476154ea68f27b5177bb7b0104209d6b6e53196088cc2676f0ff5e56a101210335edaff18efa85748f174ca3dc8753e559da948674ba35adba127d8d5333d2e9ffffffff0200000000000000001976a9146f4702f309fbcef2acf6693ad489990e16713b5e88accf0000000600000006617661746172000203313233227448347a3833776b345836527966667239535269366a6f59324e3941417932686757c4014aac160000001976a914b769819d6b0ebe9c60be6cf02d7c165e13c5ac6888ac010000000000000000000000");
        //this.decode("0400000002fb38758e2289d7ca432557259d77172aea9f1185fb759faf3c4c7f7925368681040000006a47304402203c0eca68777a4886d16b104820da450d2323e08d59e9531ac556746c6fefabd102206710afe5eb8c898f351e2e688def11b3d60f4cea33d95a4a7940f9e2a142f774012102cfa7977da665ed17840813c0afa4e6b3be7bcd6c33fca12561e0ffab5a823adffffffffffb38758e2289d7ca432557259d77172aea9f1185fb759faf3c4c7f7925368681020000006a47304402207f8670089a3d10f93f37ed19ac94414f84556c78f9f599493995f27a51a2998002204e49d86fc012b8a9cad7faedcf96f39d12b7a28fd172497ad064fa7725ad4be9012102cfa7977da665ed17840813c0afa4e6b3be7bcd6c33fca12561e0ffab5a823adfffffffff0200000000000000001976a91485df6dc5a453fcaba91531e4d6b21e8fe3ee359088accf000000050000000c546573744163636f756e7435000554455354350c546573744163636f756e743522744b38546151697839515367614141505461556a374e774b4d66626b57524b6756660200000002f0cde10c180900001976a91485df6dc5a453fcaba91531e4d6b21e8fe3ee359088ac010000000000000000000000")
    }

    cancel(e) {
        e.preventDefault()
        this.navCtrl.pop()
    }

    decode(tx) {
        this.mvs.decodeTx(tx)       //Try if the transaction can be decoded, if not, shows an error
            .then((result) => this.nav.push("confirm-tx-page", { tx: tx }))
            .catch((error) => {
                console.error(error);
                this.alert.showErrorTranslated('MESSAGE.ERROR_DECODE_TX_SUBTITLE', 'MESSAGE.ERROR_DECODE_TX_BODY')
            })
    }

    onInputChange() {
        this.input = this.input.split(/[\n ]+/).join('')
    }

}
